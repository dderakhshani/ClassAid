<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-button (click)="back()">
                <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
            </ion-button>
        </ion-buttons>
        <ion-title>بررسی تکالیف،تمرین</ion-title>

    </ion-toolbar>
</ion-header>

<ion-content>
    <div class="pb-5">
        <app-expandable-section [(expanded)]="expanded">
            <div class="homework">
                <ion-item lines="none">
                    <ion-avatar slot="start">
                        <ion-icon name="library-outline" color="success" size="large"></ion-icon>
                    </ion-avatar>
                    <ion-label>
                        <ion-note> {{homeWork?.dueTime | date}}</ion-note>
                        <h3> {{homeWork?.title}}</h3>
                        <p> {{homeWork?.description}}</p>
                    </ion-label>

                </ion-item>
                <div *ngIf="expanded">
                    <div class="upload-item m-1 d-flex" *ngFor="let file of homeWork?.files">

                        <a [href]="imageUrl+'/'+file" target="_blank" *ngIf="!homeWorkModel.isImageFile(homeWorkModel.getExtension(file))" class="d-flex flex-column align-items-center align-self-stretch">
                            <ion-icon name="document-outline" class="mx-auto" size="large"></ion-icon>
                            <div class="px-1.5 rounded text-sm font-semibold leading-5 text-white " [class.bg-danger]="homeWorkModel.getExtension(file)  === 'PDF'" [class.bg-primary]="homeWorkModel.getExtension(file)  === 'DOC'" [class.bg-primary]="homeWorkModel.getExtension(file)  === 'DOCX'" [class.bg-success]="homeWorkModel.getExtension(file)  === 'XLSX'" [class.bg-success]="homeWorkModel.getExtension(file)  === 'XLS'" [class.bg-secondary]="homeWorkModel.getExtension(file) === 'TXT'">
                                {{homeWorkModel.getExtension(file) }}
                            </div>
                        </a>
                        <img *ngIf="homeWorkModel.isImageFile(homeWorkModel.getExtension(file))" (click)="openViewer(imageUrl+'/'+file)" [src]="imageUrl+'/'+file">

                    </div>
                </div>
            </div>
        </app-expandable-section>


        <ion-grid fixed class="mt-3">
            <ion-row>
                <ion-col size="4" *ngFor="let student of studentHomeWorkAssess " class="d-flex  align-items-stretch">
                    <ion-card class="student-card flex-fill" (click)="onAssess(student)">

                        <ion-badge *ngIf="student.level>0" color="warning" class="score-rate" mode="ios">
                            <ion-icon src="../../../../assets/coins.svg" class="me-2" size="small">
                            </ion-icon>
                            <span> {{student.progerssStep}}</span>
                        </ion-badge>

                        <!-- Avatar -->
                        <div class="d-flex justify-content-center pt-2">
                            <ion-avatar slot="start">
                                <img alt="Avatar-Student" [src]="student.student.getImageUrl()" onerror="this.src='/assets/img/avatar.webp'" />
                            </ion-avatar>
                        </div>

                        <ion-card-header class="p-1">
                            <ion-card-subtitle class="text-center">
                                {{student.student.fullName}}
                            </ion-card-subtitle>
                        </ion-card-header>
                        <ion-card-content class="px-2 pt-0 pb-1 d-flex justify-content-center">
                            <ion-badge [color]="student.accessLevel.ionColor" class="px-3 py-2">
                                <span class="min">{{student.accessLevel.title}} </span>
                            </ion-badge>
                        </ion-card-content>
                    </ion-card>
                </ion-col>

            </ion-row>
        </ion-grid>

        <ion-modal [isOpen]="isModalOpen" (didDismiss)="isModalOpen=false" [initialBreakpoint]="0.25" [breakpoints]="[0, 0.25]">
            <ng-template>
                <div class="p-3">
                    <ion-segment [scrollable]="true" mode="ios" [(ngModel)]="assess.level">
                        <ion-segment-button value="{{am.value}}" class="{{am.bdColor}}" *ngFor="let am of assessLevels">
                            <ion-icon [name]="am.ionIcon"></ion-icon>
                            <ion-label>
                                {{am.title}}
                            </ion-label>
                        </ion-segment-button>
                    </ion-segment>
                    <div class="mt-2">
                        <app-score-rating [maxScore]="10" [(score)]="assess.progerssStep"></app-score-rating>
                    </div>
                    <div class="mt-2">
                        <ion-button expand="block" (click)="addAssess()" color="secondary">
                            <ion-icon name="save-outline" size="large"></ion-icon>
                            <ion-label class="me-2"> ذخیره</ion-label>
                        </ion-button>
                    </div>
                </div>


            </ng-template>
        </ion-modal>

        <!-- <div *ngFor="let student of studentHomeWorkAssess ">
            <ion-card class="student-card flex-fill">
                <ion-card-content>
                    <div class="d-flex flex-column ion-align-items-center">
                        <ion-avatar slot="start">
                            <img alt="Avatar-Student" [src]="student.student.getImageUrl()" onerror="this.src='/assets/img/avatar.webp'" />
                        </ion-avatar>
                        <div>
                            {{student.student.fullName}}
                        </div>

                        <ion-segment [scrollable]="true" mode="ios" [(ngModel)]="student.level">
                            <ion-segment-button value="{{am.value}}" class="{{am.bdColor}}" *ngFor="let am of assessLevels">
                                <ion-icon [name]="am.ionIcon"></ion-icon>
                                <ion-label>
                                    {{am.title}}
                                </ion-label>
                            </ion-segment-button>
                        </ion-segment>
                        <app-score-rating [maxScore]="10" [(score)]="student.progerssStep"></app-score-rating>
                    </div>
                </ion-card-content>
            </ion-card>
        </div> -->
    </div>
</ion-content>

<ion-footer>
    <ion-grid fixed class="p-2 pb-3">
        <ion-row>
            <ion-col size="6">
                <ion-button expand="block" (click)="save(false)" color="secondary">
                    <ion-icon name="save-outline" size="large"></ion-icon>
                    <ion-label class="me-2"> ذخیره</ion-label>
                </ion-button>
            </ion-col>
            <ion-col size="6">
                <ion-button expand="block" (click)="save(true)" color="success">
                    <ion-icon name="save-outline" size="large"></ion-icon>
                    <ion-label class="me-2"> ذخیره و اتمام</ion-label>
                </ion-button>
            </ion-col>
        </ion-row>
    </ion-grid>
</ion-footer>